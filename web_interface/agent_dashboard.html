<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Management Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .card-subtitle {
            font-size: 13px;
            color: #999;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active { background: #d4edda; color: #155724; }
        .status-idle { background: #fff3cd; color: #856404; }
        .status-busy { background: #cce5ff; color: #004085; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-offline { background: #e2e3e5; color: #383d41; }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .agent-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .agent-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .agent-type {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }

        .agent-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .metric {
            display: flex;
            flex-direction: column;
        }

        .metric-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .health-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
        }

        .health-fill.warning {
            background: linear-gradient(90deg, #ff9800, #ffc107);
        }

        .health-fill.critical {
            background: linear-gradient(90deg, #f44336, #e91e63);
        }

        .capabilities {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }

        .capability-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            color: #333;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .coordination-timeline {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
        }

        .timeline-event {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border-left: 3px solid #667eea;
            margin-left: 10px;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .timeline-event:hover {
            background: #e9ecef;
        }

        .event-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .event-content {
            flex: 1;
        }

        .event-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .event-details {
            font-size: 13px;
            color: #666;
        }

        .event-time {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 20px;
        }

        .refresh-btn:hover {
            background: #5568d3;
        }

        .refresh-btn:active {
            transform: scale(0.98);
        }

        .auto-refresh {
            display: inline-flex;
            align-items: center;
            margin-left: 15px;
            font-size: 14px;
            color: #666;
        }

        .auto-refresh input {
            margin-right: 6px;
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🤖 Agent Management Dashboard</h1>
        <div class="subtitle">Real-time monitoring and management of AI fraud detection agents</div>
    </div>

    <div class="container">
        <div style="margin-bottom: 20px;">
            <button class="refresh-btn" onclick="refreshDashboard()">🔄 Refresh Dashboard</button>
            <label class="auto-refresh">
                <input type="checkbox" id="autoRefresh" checked onchange="toggleAutoRefresh()">
                Auto-refresh (5s)
            </label>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards" id="summaryCards">
            <div class="loading">
                <div class="spinner"></div>
                Loading dashboard data...
            </div>
        </div>

        <!-- Agents Grid -->
        <h2 class="section-title">Active Agents</h2>
        <div class="agents-grid" id="agentsGrid">
            <div class="loading">
                <div class="spinner"></div>
                Loading agents...
            </div>
        </div>

        <!-- Coordination Timeline -->
        <h2 class="section-title">Recent Coordination Events</h2>
        <div class="coordination-timeline" id="coordinationTimeline">
            <div class="loading">
                <div class="spinner"></div>
                Loading coordination events...
            </div>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let mockData = null;

        // Initialize mock data
        function initializeMockData() {
            mockData = {
                summary: {
                    timestamp: new Date().toISOString(),
                    agents: {
                        total: 5,
                        active: 4,
                        idle: 1,
                        busy: 0,
                        error: 0,
                        offline: 0
                    },
                    performance: {
                        total_requests_processed: 15847,
                        total_errors: 23,
                        overall_success_rate: 0.9985,
                        average_health_score: 0.952,
                        average_response_time_ms: 145.3
                    },
                    coordination: {
                        total_events: 342,
                        recent_events: 28
                    },
                    alerts: {
                        total: 2,
                        critical: 0
                    }
                },
                agents: [
                    {
                        agent_id: "txn_analyzer_001",
                        agent_name: "Transaction Analyzer",
                        agent_type: "transaction_analyzer",
                        status: "active",
                        version: "1.2.0",
                        capabilities: ["real_time_processing", "velocity_detection", "amount_analysis"],
                        metrics: {
                            requests_processed: 5234,
                            average_response_time_ms: 123.5,
                            success_rate: 0.998,
                            error_count: 10,
                            current_load: 0.45,
                            uptime_seconds: 86400,
                            memory_usage_mb: 256.3,
                            cpu_usage_percent: 34.2
                        },
                        health_score: 0.965
                    },
                    {
                        agent_id: "pattern_detector_001",
                        agent_name: "Pattern Detector",
                        agent_type: "pattern_detector",
                        status: "active",
                        version: "1.1.5",
                        capabilities: ["anomaly_detection", "behavioral_analysis", "trend_prediction"],
                        metrics: {
                            requests_processed: 3421,
                            average_response_time_ms: 187.2,
                            success_rate: 0.995,
                            error_count: 17,
                            current_load: 0.62,
                            uptime_seconds: 86400,
                            memory_usage_mb: 412.7,
                            cpu_usage_percent: 52.8
                        },
                        health_score: 0.923
                    },
                    {
                        agent_id: "risk_assessor_001",
                        agent_name: "Risk Assessor",
                        agent_type: "risk_assessor",
                        status: "active",
                        version: "1.3.2",
                        capabilities: ["multi_factor_scoring", "geographic_analysis", "temporal_analysis"],
                        metrics: {
                            requests_processed: 4892,
                            average_response_time_ms: 98.7,
                            success_rate: 0.999,
                            error_count: 5,
                            current_load: 0.38,
                            uptime_seconds: 86400,
                            memory_usage_mb: 198.5,
                            cpu_usage_percent: 28.3
                        },
                        health_score: 0.982
                    },
                    {
                        agent_id: "compliance_001",
                        agent_name: "Compliance Agent",
                        agent_type: "compliance",
                        status: "idle",
                        version: "1.0.0",
                        capabilities: ["regulatory_checking", "audit_trail", "policy_enforcement"],
                        metrics: {
                            requests_processed: 1245,
                            average_response_time_ms: 234.1,
                            success_rate: 1.0,
                            error_count: 0,
                            current_load: 0.12,
                            uptime_seconds: 86400,
                            memory_usage_mb: 145.2,
                            cpu_usage_percent: 15.7
                        },
                        health_score: 0.958
                    },
                    {
                        agent_id: "orchestrator_001",
                        agent_name: "Agent Orchestrator",
                        agent_type: "orchestrator",
                        status: "active",
                        version: "2.0.1",
                        capabilities: ["coordination", "decision_aggregation", "workflow_management"],
                        metrics: {
                            requests_processed: 1055,
                            average_response_time_ms: 67.3,
                            success_rate: 0.997,
                            error_count: 3,
                            uptime_seconds: 86400,
                            memory_usage_mb: 178.9,
                            cpu_usage_percent: 22.1
                        },
                        health_score: 0.975
                    }
                ],
                coordination_events: [
                    {
                        event_id: "evt_001",
                        timestamp: new Date(Date.now() - 30000).toISOString(),
                        event_type: "request",
                        source_agent: "orchestrator_001",
                        target_agent: "txn_analyzer_001",
                        transaction_id: "tx_12345",
                        status: "completed",
                        duration_ms: 125.3
                    },
                    {
                        event_id: "evt_002",
                        timestamp: new Date(Date.now() - 28000).toISOString(),
                        event_type: "response",
                        source_agent: "txn_analyzer_001",
                        target_agent: "orchestrator_001",
                        transaction_id: "tx_12345",
                        status: "completed",
                        duration_ms: 98.7
                    },
                    {
                        event_id: "evt_003",
                        timestamp: new Date(Date.now() - 25000).toISOString(),
                        event_type: "coordination",
                        source_agent: "orchestrator_001",
                        target_agent: "risk_assessor_001",
                        transaction_id: "tx_12345",
                        status: "completed",
                        duration_ms: 87.2
                    },
                    {
                        event_id: "evt_004",
                        timestamp: new Date(Date.now() - 20000).toISOString(),
                        event_type: "request",
                        source_agent: "orchestrator_001",
                        target_agent: "pattern_detector_001",
                        transaction_id: "tx_12346",
                        status: "completed",
                        duration_ms: 156.8
                    },
                    {
                        event_id: "evt_005",
                        timestamp: new Date(Date.now() - 15000).toISOString(),
                        event_type: "escalation",
                        source_agent: "risk_assessor_001",
                        target_agent: "compliance_001",
                        transaction_id: "tx_12347",
                        status: "in_progress",
                        duration_ms: 0
                    }
                ]
            };
        }

        function renderSummaryCards(summary) {
            const container = document.getElementById('summaryCards');
            container.innerHTML = `
                <div class="card">
                    <div class="card-title">Total Agents</div>
                    <div class="card-value">${summary.agents.total}</div>
                    <div class="card-subtitle">${summary.agents.active} active, ${summary.agents.error} errors</div>
                </div>
                <div class="card">
                    <div class="card-title">Requests Processed</div>
                    <div class="card-value">${summary.performance.total_requests_processed.toLocaleString()}</div>
                    <div class="card-subtitle">${summary.performance.total_errors} errors</div>
                </div>
                <div class="card">
                    <div class="card-title">Success Rate</div>
                    <div class="card-value">${(summary.performance.overall_success_rate * 100).toFixed(2)}%</div>
                    <div class="card-subtitle">Overall system performance</div>
                </div>
                <div class="card">
                    <div class="card-title">Avg Response Time</div>
                    <div class="card-value">${summary.performance.average_response_time_ms.toFixed(1)}<span style="font-size: 16px;">ms</span></div>
                    <div class="card-subtitle">Across all agents</div>
                </div>
                <div class="card">
                    <div class="card-title">Health Score</div>
                    <div class="card-value">${(summary.performance.average_health_score * 100).toFixed(1)}%</div>
                    <div class="card-subtitle">System health</div>
                </div>
            `;
        }

        function getHealthBarClass(score) {
            if (score >= 0.9) return '';
            if (score >= 0.7) return 'warning';
            return 'critical';
        }

        function renderAgents(agents) {
            const container = document.getElementById('agentsGrid');
            container.innerHTML = agents.map(agent => `
                <div class="agent-card">
                    <div class="agent-header">
                        <div>
                            <div class="agent-name">${agent.agent_name}</div>
                            <div class="agent-type">${agent.agent_type.replace(/_/g, ' ')}</div>
                        </div>
                        <span class="status-badge status-${agent.status}">${agent.status}</span>
                    </div>
                    
                    <div class="agent-metrics">
                        <div class="metric">
                            <div class="metric-label">Requests</div>
                            <div class="metric-value">${agent.metrics.requests_processed.toLocaleString()}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Success Rate</div>
                            <div class="metric-value">${(agent.metrics.success_rate * 100).toFixed(1)}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Avg Response</div>
                            <div class="metric-value">${agent.metrics.average_response_time_ms.toFixed(0)}ms</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Load</div>
                            <div class="metric-value">${(agent.metrics.current_load * 100).toFixed(0)}%</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <div class="metric-label">Health Score: ${(agent.health_score * 100).toFixed(1)}%</div>
                        <div class="health-bar">
                            <div class="health-fill ${getHealthBarClass(agent.health_score)}" 
                                 style="width: ${agent.health_score * 100}%"></div>
                        </div>
                    </div>
                    
                    <div class="capabilities">
                        ${agent.capabilities.map(cap => 
                            `<span class="capability-tag">${cap.replace(/_/g, ' ')}</span>`
                        ).join('')}
                    </div>
                </div>
            `).join('');
        }

        function getEventIcon(eventType) {
            const icons = {
                'request': '📤',
                'response': '📥',
                'coordination': '🔄',
                'escalation': '⚠️',
                'configuration_change': '⚙️'
            };
            return icons[eventType] || '📋';
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);
            
            if (diff < 60) return `${diff}s ago`;
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return date.toLocaleString();
        }

        function renderCoordinationEvents(events) {
            const container = document.getElementById('coordinationTimeline');
            if (events.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">No recent coordination events</div>';
                return;
            }
            
            container.innerHTML = events.map(event => `
                <div class="timeline-event">
                    <div class="event-icon">${getEventIcon(event.event_type)}</div>
                    <div class="event-content">
                        <div class="event-title">${event.event_type.replace(/_/g, ' ').toUpperCase()}</div>
                        <div class="event-details">
                            ${event.source_agent} ${event.target_agent ? `→ ${event.target_agent}` : ''}
                            ${event.transaction_id ? `| Transaction: ${event.transaction_id}` : ''}
                        </div>
                        <div class="event-time">
                            ${formatTimestamp(event.timestamp)} | 
                            Duration: ${event.duration_ms.toFixed(1)}ms | 
                            Status: ${event.status}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function refreshDashboard() {
            // Simulate data updates
            if (mockData) {
                // Update metrics with some randomness
                mockData.agents.forEach(agent => {
                    agent.metrics.requests_processed += Math.floor(Math.random() * 10);
                    agent.metrics.current_load = Math.max(0.1, Math.min(0.9, agent.metrics.current_load + (Math.random() - 0.5) * 0.1));
                    agent.metrics.average_response_time_ms += (Math.random() - 0.5) * 10;
                });
                
                // Update summary
                mockData.summary.performance.total_requests_processed = mockData.agents.reduce((sum, a) => sum + a.metrics.requests_processed, 0);
            }
            
            renderSummaryCards(mockData.summary);
            renderAgents(mockData.agents);
            renderCoordinationEvents(mockData.coordination_events);
        }

        function toggleAutoRefresh() {
            const checkbox = document.getElementById('autoRefresh');
            if (checkbox.checked) {
                autoRefreshInterval = setInterval(refreshDashboard, 5000);
            } else {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeMockData();
            refreshDashboard();
            toggleAutoRefresh();
        });
    </script>
</body>
</html>
